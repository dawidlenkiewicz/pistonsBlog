<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Day Card</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #080808; display: flex; height: 100vh; overflow: hidden; font-family: 'Barlow Condensed', sans-serif; color: #ccc; }

#controls {
  width: 240px; min-width: 240px; background: #0a0a0a;
  border-right: 1px solid #1c1c1c; height: 100vh; overflow-y: auto; flex-shrink: 0;
}
.panel-header { padding: 14px 16px; border-bottom: 1px solid #1a1a1a; display: flex; align-items: center; justify-content: space-between; }
.panel-title { font-size: 10px; font-weight: 700; letter-spacing: 3px; text-transform: uppercase; color: #C8102E; }
.close-btn { background: none; border: none; color: #444; font-size: 16px; cursor: pointer; }
.close-btn:hover { color: #ccc; }
.panel-body { padding: 14px 16px; }
.fl { font-size: 9px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: #333; margin-bottom: 5px; margin-top: 12px; }
.fl:first-child { margin-top: 0; }
select, input[type=text], input[type=url] {
  width: 100%; background: #161616; border: 1px solid #222; color: #ccc;
  padding: 8px 10px; font-family: 'Barlow Condensed', sans-serif; font-size: 13px; outline: none;
}
select:focus, input:focus { border-color: #444; }
.sw { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 2px; }
.s { width: 26px; height: 26px; cursor: pointer; flex-shrink: 0; }
.s.active { outline: 2px solid #fff; outline-offset: 2px; }
.gi { font-size: 11px; color: #C8102E; font-weight: 700; letter-spacing: 1px; padding: 8px 10px; background: #111; border-left: 2px solid #C8102E; margin-bottom: 12px; }
.ht { font-size: 9px; color: #1e1e1e; margin-top: 3px; line-height: 1.5; }
.ht a { color: #333; }
.sd { border: none; border-top: 1px solid #1a1a1a; margin: 14px 0; }
.sh { font-size: 9px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: #C8102E; margin-bottom: 8px; }

#preview {
  flex: 1; display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 30px; overflow-y: auto; background: #060606; gap: 12px;
}
.pl { font-size: 9px; font-weight: 700; letter-spacing: 4px; text-transform: uppercase; color: #1e1e1e; }
.dl-btn { background: #C8102E; color: #fff; border: none; font-family: 'Barlow Condensed', sans-serif; font-size: 12px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; padding: 10px 24px; cursor: pointer; margin-top: 4px; }
.dl-btn:hover { background: #a50d24; }
.dl-btn:disabled { background: #333; color: #666; cursor: default; }

#gd-card {
  width: 360px; height: 640px; position: relative; overflow: hidden; flex-shrink: 0;
  box-shadow: 0 30px 80px rgba(0,0,0,0.9), 0 0 0 1px #1a1a1a;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

<div id="controls">
  <div class="panel-header">
    <div class="panel-title">ðŸ“… Game Day</div>
    <button class="close-btn" onclick="window.close()">âœ•</button>
  </div>
  <div class="panel-body">

    <div id="gd-game-info" class="gi">No game loaded</div>

    <div class="sh">General</div>

    <div class="fl">Label</div>
    <select id="gd-label" onchange="gdRender()">
      <option value="HOME GAME DAY">HOME GAME DAY</option>
      <option value="AWAY GAME DAY">AWAY GAME DAY</option>
      <option value="GAME DAY">GAME DAY</option>
      <option value="MATCH DAY">MATCH DAY</option>
    </select>

    <div class="fl">Accent Color</div>
    <div class="sw" id="acc">
      <div class="s active" style="background:#C8102E;" onclick="setAccent('#C8102E',this)"></div>
      <div class="s" style="background:#1d428a;" onclick="setAccent('#1d428a',this)"></div>
      <div class="s" style="background:#f5c518;" onclick="setAccent('#f5c518',this)"></div>
      <div class="s" style="background:#fff;border:1px solid #444;" onclick="setAccent('#ffffff',this)"></div>
      <input type="color" value="#C8102E" oninput="gdAccent=this.value;document.querySelectorAll('#acc .s').forEach(d=>d.classList.remove('active'));gdRender();" style="width:26px;height:26px;padding:1px;border:1px solid #333;background:#161616;cursor:pointer;">
    </div>

    <hr class="sd">
    <div class="sh">â—€ Left Player</div>

    <div class="fl">Cutout URL</div>
    <input type="url" id="url-left" placeholder="https://â€¦" oninput="gdRender()">
    <div class="ht">Use <a href="https://remove.bg" target="_blank">remove.bg</a> first</div>

    <div class="fl">Size <span id="left-size-val" style="color:#555;font-weight:400;letter-spacing:0;text-transform:none;">100%</span></div>
    <input type="range" id="size-left" min="50" max="160" value="100" oninput="document.getElementById('left-size-val').textContent=this.value+'%';gdRender()" style="width:100%;accent-color:#C8102E;cursor:pointer;">

    <div class="fl">Vertical <span id="left-vert-val" style="color:#555;font-weight:400;letter-spacing:0;text-transform:none;">0px</span></div>
    <input type="range" id="vert-left" min="-120" max="80" value="0" oninput="document.getElementById('left-vert-val').textContent=this.value+'px';gdRender()" style="width:100%;accent-color:#C8102E;cursor:pointer;">

    <div class="fl">Horizontal <span id="left-horiz-val" style="color:#555;font-weight:400;letter-spacing:0;text-transform:none;">0px</span></div>
    <input type="range" id="horiz-left" min="-120" max="120" value="0" oninput="document.getElementById('left-horiz-val').textContent=this.value+'px';gdRender()" style="width:100%;accent-color:#C8102E;cursor:pointer;">

    <div class="fl">Background</div>
    <div class="sw" id="lbg">
      <div class="s active" style="background:#1d428a;" onclick="setLBg('#1d428a',this)"></div>
      <div class="s" style="background:#0a0a0a;border:1px solid #333;" onclick="setLBg('#0a0a0a',this)"></div>
      <div class="s" style="background:#C8102E;" onclick="setLBg('#C8102E',this)"></div>
      <div class="s" style="background:#f5c518;" onclick="setLBg('#f5c518',this)"></div>
      <input type="color" value="#1d428a" oninput="lBg=this.value;document.querySelectorAll('#lbg .s').forEach(d=>d.classList.remove('active'));gdRender();" style="width:26px;height:26px;padding:1px;border:1px solid #333;background:#161616;cursor:pointer;">
    </div>

    <hr class="sd">
    <div class="sh">â–¶ Right Player</div>

    <div class="fl">Cutout URL</div>
    <input type="url" id="url-right" placeholder="https://â€¦" oninput="gdRender()">

    <div class="fl">Size <span id="right-size-val" style="color:#555;font-weight:400;letter-spacing:0;text-transform:none;">100%</span></div>
    <input type="range" id="size-right" min="50" max="160" value="100" oninput="document.getElementById('right-size-val').textContent=this.value+'%';gdRender()" style="width:100%;accent-color:#C8102E;cursor:pointer;">

    <div class="fl">Vertical <span id="right-vert-val" style="color:#555;font-weight:400;letter-spacing:0;text-transform:none;">0px</span></div>
    <input type="range" id="vert-right" min="-120" max="80" value="0" oninput="document.getElementById('right-vert-val').textContent=this.value+'px';gdRender()" style="width:100%;accent-color:#C8102E;cursor:pointer;">

    <div class="fl">Horizontal <span id="right-horiz-val" style="color:#555;font-weight:400;letter-spacing:0;text-transform:none;">0px</span></div>
    <input type="range" id="horiz-right" min="-120" max="120" value="0" oninput="document.getElementById('right-horiz-val').textContent=this.value+'px';gdRender()" style="width:100%;accent-color:#C8102E;cursor:pointer;">

    <div class="fl">Background</div>
    <div class="sw" id="rbg">
      <div class="s active" style="background:#C8102E;" onclick="setRBg('#C8102E',this)"></div>
      <div class="s" style="background:#1d428a;" onclick="setRBg('#1d428a',this)"></div>
      <div class="s" style="background:#0a0a0a;border:1px solid #333;" onclick="setRBg('#0a0a0a',this)"></div>
      <div class="s" style="background:#f5c518;" onclick="setRBg('#f5c518',this)"></div>
      <input type="color" value="#C8102E" oninput="rBg=this.value;document.querySelectorAll('#rbg .s').forEach(d=>d.classList.remove('active'));gdRender();" style="width:26px;height:26px;padding:1px;border:1px solid #333;background:#161616;cursor:pointer;">
    </div>

    <div class="ht" style="margin-top:24px;text-align:center;color:#1a1a1a;">Screenshot: Cmd+Shift+4 Â· Win+Shift+S</div>
  </div>
</div>

<div id="preview">
  <div class="pl">Screenshot or download below â†“</div>
  <button class="dl-btn" id="dl-btn" onclick="downloadCard()">â¬‡ Download PNG</button>
  <div id="gd-card">
    <!-- rendered by JS -->
  </div>
</div>

<script>
let gdAccent = '#C8102E';
let lBg = '#1d428a';
let rBg = '#C8102E';
let gdGame = null;

const DET_LOGO = 'https://a.espncdn.com/i/teamlogos/nba/500/det.png';
const CARD_H = 640, CARD_W = 360;
const TOP_H = 166, BOT_H = 116;
const MID_TOP = TOP_H + 2, MID_H = CARD_H - TOP_H - BOT_H - 2;

try {
  const raw = sessionStorage.getItem('gdGameData');
  if (raw) { gdGame = JSON.parse(raw); }
} catch(e) {}

function init() {
  if (gdGame) {
    const d = new Date(gdGame.date);
    const ds = d.toLocaleDateString('en-US', {month:'short', day:'numeric'});
    document.getElementById('gd-game-info').textContent = ds + ' ' + (gdGame.isHome ? 'vs' : '@') + ' ' + gdGame.opp;
    document.getElementById('gd-label').value = gdGame.isHome ? 'HOME GAME DAY' : 'AWAY GAME DAY';
  } else {
    document.getElementById('gd-game-info').textContent = 'Select a game in main app first';
  }
  gdRender();
}

function setAccent(col, el) { gdAccent=col; document.querySelectorAll('#acc .s').forEach(d=>d.classList.remove('active')); el.classList.add('active'); gdRender(); }
function setLBg(col, el)    { lBg=col;     document.querySelectorAll('#lbg .s').forEach(d=>d.classList.remove('active')); el.classList.add('active'); gdRender(); }
function setRBg(col, el)    { rBg=col;     document.querySelectorAll('#rbg .s').forEach(d=>d.classList.remove('active')); el.classList.add('active'); gdRender(); }

function playerImg(url, horiz, size, vert, shadow, side) {
  if (!url) return '';
  const offset = parseInt(horiz) || 0;
  // side=left: positive horiz moves right, negative moves left (base is -30px)
  // side=right: positive horiz moves right, negative moves left (base is -30px)
  const pos = side === 'left'
    ? 'left:' + (-30 + offset) + 'px'
    : 'right:' + (-30 - offset) + 'px';
  return '<img src="' + url + '" style="position:absolute;bottom:' + vert + 'px;' + pos + ';height:' + size + '%;object-fit:contain;object-position:bottom;filter:' + shadow + ';z-index:3;">';
}

function gdRender() {
  const label    = document.getElementById('gd-label').value;
  const leftUrl  = document.getElementById('url-left').value.trim();
  const rightUrl = document.getElementById('url-right').value.trim();
  const leftSize  = document.getElementById('size-left').value;
  const rightSize = document.getElementById('size-right').value;
  const leftVert  = document.getElementById('vert-left').value;
  const rightVert = document.getElementById('vert-right').value;
  const leftHoriz  = document.getElementById('horiz-left').value;
  const rightHoriz = document.getElementById('horiz-right').value;
  const isHome   = gdGame ? gdGame.isHome : true;
  const oppLogo  = gdGame?.oppLogo || '';
  const oppCity  = gdGame?.opp || 'Opponent';

  // Scoreboard: away on left, home on right
  const scoreLLeft = isHome ? oppLogo  : DET_LOGO;
  const scoreLRight= isHome ? DET_LOGO : oppLogo;
  const scoreNLeft = isHome ? oppCity  : 'Pistons';
  const scoreNRight= isHome ? 'Pistons': oppCity;

  // Label split: HOME/AWAY small on top, rest big
  const words = label.split(' ');
  const hasPrefix = words.length > 2 && (words[0]==='HOME'||words[0]==='AWAY');
  const smallText = hasPrefix ? words[0] : '';
  const bigText   = hasPrefix ? words.slice(1).join(' ') : label;

  document.getElementById('gd-card').innerHTML = `
    <div style="position:absolute;inset:0;background:#0d0d14;"></div>

    <!-- TOP scoreboard -->
    <div style="position:absolute;top:12px;left:12px;right:12px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);padding:14px 18px;z-index:5;display:flex;align-items:center;justify-content:space-between;">
      <div style="text-align:center;">
        <img src="${scoreLLeft}" style="width:100px;height:100px;object-fit:contain;filter:drop-shadow(0 2px 10px rgba(0,0,0,0.8));" onerror="this.style.display='none'">
        <div style="font-size:8px;font-weight:700;letter-spacing:2px;color:#777;margin-top:5px;text-transform:uppercase;">${scoreNLeft}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:center;gap:3px;">
        <div style="width:1px;height:12px;background:#2a2a2a;"></div>
        <div style="font-size:24px;font-weight:900;font-style:italic;color:${gdAccent};">VS</div>
        <div style="width:1px;height:12px;background:#2a2a2a;"></div>
      </div>
      <div style="text-align:center;">
        <img src="${scoreLRight}" style="width:100px;height:100px;object-fit:contain;filter:drop-shadow(0 2px 10px rgba(0,0,0,0.8));" onerror="this.style.display='none'">
        <div style="font-size:8px;font-weight:700;letter-spacing:2px;color:#777;margin-top:5px;text-transform:uppercase;">${scoreNRight}</div>
      </div>
    </div>

    <!-- MIDDLE diagonal split -->
    <div style="position:absolute;top:${MID_TOP}px;left:0;right:0;height:${MID_H}px;overflow:hidden;">
      <!-- left bg -->
      <div style="position:absolute;inset:0;background:${lBg};"></div>
      <!-- right bg: exact 50/50 split with thin diagonal -->
      <div style="position:absolute;top:0;right:0;bottom:0;width:50%;background:${rBg};clip-path:polygon(8% 0%,100% 0%,100% 100%,0% 100%);"></div>

      <!-- left player -->
      ${playerImg(leftUrl, leftHoriz, leftSize, leftVert, 'drop-shadow(8px 0 20px rgba(0,0,0,0.6))', 'left')}
      <!-- right player -->
      ${playerImg(rightUrl, rightHoriz, rightSize, rightVert, 'drop-shadow(-8px 0 20px rgba(0,0,0,0.5))', 'right')}
    </div>

    <!-- BOTTOM text -->
    <div style="position:absolute;bottom:0;left:0;right:0;height:${BOT_H}px;display:flex;flex-direction:column;justify-content:center;padding:0 22px 16px;z-index:5;">
      ${smallText ? `<div style="font-size:14px;font-weight:700;letter-spacing:3px;color:${gdAccent};margin-bottom:0;">${smallText}</div>` : ''}
      <div style="font-size:56px;font-weight:900;font-style:italic;color:#fff;line-height:0.88;letter-spacing:0;">${bigText}</div>
    </div>
  `;
}

init();

function downloadCard() {
  const btn = document.getElementById('dl-btn');
  btn.disabled = true;
  btn.textContent = 'â³ Renderingâ€¦';
  const card = document.getElementById('gd-card');
  html2canvas(card, { scale: 3, useCORS: true, allowTaint: true, backgroundColor: null }).then(canvas => {
    const link = document.createElement('a');
    link.download = 'gameday.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    btn.disabled = false;
    btn.textContent = 'â¬‡ Download PNG';
  }).catch(err => {
    console.error(err);
    btn.disabled = false;
    btn.textContent = 'â¬‡ Download PNG';
  });
}
</script>
</body>
</html>
